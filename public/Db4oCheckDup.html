<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta name="GENERATOR" content="SciTE - www.Scintilla.org" />
<style type="text/css">
.S0 {
	color: #808080;
	background: #FFFFFF;
}
.S4 {
	color: #007F7F;
	background: #FFFFFF;
}
.S5 {
	font-weight: bold;
	color: #00007F;
	background: #FFFFFF;
}
.S6 {
	color: #7F007F;
	background: #FFFFFF;
}
.S10 {
	font-weight: bold;
	color: #000000;
	background: #FFFFFF;
}
span {
	font-family: 'Consolas';
	color: #000000;
	background: #FFFFFF;
	font-size: 10pt;
}
</style>
</head>
<body bgcolor="#FFFFFF">
<span><span class="S5">package</span><span class="S0"> </span>com<span class="S10">.</span>stetits<span class="S10">.</span>core<span class="S10">.</span>dup<span class="S10">.</span>dbengines<span class="S10">;</span><br />
<br />
<span class="S5">import</span><span class="S0"> </span>java<span class="S10">.</span>io<span class="S10">.*;</span><br />
<span class="S5">import</span><span class="S0"> </span>java<span class="S10">.</span>sql<span class="S10">.*;</span><br />
<br />
<span class="S5">import</span><span class="S0"> </span>com<span class="S10">.</span>db4o<span class="S10">.*;</span><br />
<span class="S5">import</span><span class="S0"> </span>com<span class="S10">.</span>db4o<span class="S10">.</span>config<span class="S10">.</span>annotations<span class="S10">.*;</span><br />
<span class="S5">import</span><span class="S0"> </span>com<span class="S10">.</span>db4o<span class="S10">.</span>query<span class="S10">.*;</span><br />
<span class="S5">import</span><span class="S0"> </span>com<span class="S10">.</span>stetits<span class="S10">.</span>core<span class="S10">.</span>dup<span class="S10">.*;</span><br />
<br />
<span class="S5">public</span><span class="S0"> </span><span class="S5">class</span><span class="S0"> </span>Db4oCheckDup<span class="S0"> </span><span class="S5">extends</span><span class="S0"> </span>CheckDup<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">static</span><span class="S0"> </span><span class="S5">class</span><span class="S0"> </span>Duplicate<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>@Indexed<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">private</span><span class="S0"> </span>String<span class="S0"> </span>digest<span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span>Duplicate<span class="S10">(</span>String<span class="S0"> </span>digest<span class="S10">)</span><span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">this</span><span class="S10">.</span>digest<span class="S0"> </span><span class="S10">=</span><span class="S0"> </span>digest<span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S10">}</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span>String<span class="S0"> </span>digest<span class="S10">()</span><span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span>digest<span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S10">}</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">static</span><span class="S0"> </span>Duplicate<span class="S0"> </span>fromByteArray<span class="S10">(</span><span class="S5">byte</span><span class="S10">[]</span><span class="S0"> </span>digest<span class="S10">)</span><span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span><span class="S5">new</span><span class="S0"> </span>Duplicate<span class="S10">(</span><span class="S5">new</span><span class="S0"> </span>String<span class="S10">(</span>digest<span class="S10">));</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S10">}</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<span class="S0">&nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">static</span><span class="S0"> </span><span class="S5">final</span><span class="S0"> </span>String<span class="S0"> </span>DB_ENGINE_NAME<span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S6">"db4o"</span><span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">private</span><span class="S0"> </span>ObjectContainer<span class="S0"> </span>db<span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">private</span><span class="S0"> </span>String<span class="S0"> </span>fileName<span class="S10">()</span><span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span>DB_ENGINE_NAME<span class="S0"> </span><span class="S10">+</span><span class="S0"> </span><span class="S6">".yap"</span><span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<span class="S0">&nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">private</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>clean<span class="S10">()</span><span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>File<span class="S0"> </span>f<span class="S0"> </span><span class="S10">=</span><span class="S0"> </span><span class="S5">new</span><span class="S0"> </span>File<span class="S10">(</span>fileName<span class="S10">());</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">if</span><span class="S0"> </span><span class="S10">(</span>f<span class="S10">.</span>exists<span class="S10">())</span><span class="S0"> </span>f<span class="S10">.</span>delete<span class="S10">();</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span>Connection<span class="S0"> </span>openConnection<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>ClassNotFoundException<span class="S10">,</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>clean<span class="S10">();</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>db<span class="S0"> </span><span class="S10">=</span><span class="S0"> </span>Db4o<span class="S10">.</span>openFile<span class="S10">(</span>fileName<span class="S10">());</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span><span class="S5">null</span><span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>shutdown<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>db<span class="S10">.</span>close<span class="S10">();</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>add<span class="S10">(</span><span class="S5">byte</span><span class="S10">[]</span><span class="S0"> </span>digest<span class="S10">)</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>db<span class="S10">.</span>set<span class="S10">(</span>Duplicate<span class="S10">.</span>fromByteArray<span class="S10">(</span>digest<span class="S10">));</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>beginTransaction<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>closeConnection<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>commit<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>db<span class="S10">.</span>commit<span class="S10">();</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>createTableDup<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>dropTableDup<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">boolean</span><span class="S0"> </span>isDup<span class="S10">(</span><span class="S5">byte</span><span class="S10">[]</span><span class="S0"> </span>digest<span class="S10">)</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>Query<span class="S0"> </span>q<span class="S0"> </span><span class="S10">=</span><span class="S0"> </span>db<span class="S10">.</span>query<span class="S10">();</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>q<span class="S10">.</span>constrain<span class="S10">(</span>Duplicate<span class="S10">.</span><span class="S5">class</span><span class="S10">);</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>q<span class="S10">.</span>descend<span class="S10">(</span><span class="S6">"digest"</span><span class="S10">).</span>constrain<span class="S10">(</span><span class="S5">new</span><span class="S0"> </span>String<span class="S10">(</span>digest<span class="S10">));</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>ObjectSet<span class="S0"> </span>result<span class="S0"> </span><span class="S10">=</span><span class="S0"> </span>q<span class="S10">.</span>execute<span class="S10">();</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span>result<span class="S10">.</span>size<span class="S10">()</span><span class="S0"> </span><span class="S10">&gt;</span><span class="S0"> </span><span class="S4">0</span><span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>purge<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span><span class="S5">synchronized</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>rollback<span class="S10">()</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span>db<span class="S10">.</span>rollback<span class="S10">();</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">public</span><span class="S0"> </span>String<span class="S0"> </span>toString<span class="S10">()</span><span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">return</span><span class="S0"> </span>DB_ENGINE_NAME<span class="S10">;</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<br />
<span class="S0">&nbsp; &nbsp; </span>@Override<br />
<span class="S0">&nbsp; &nbsp; </span><span class="S5">protected</span><span class="S0"> </span><span class="S5">void</span><span class="S0"> </span>update<span class="S10">(</span>String<span class="S0"> </span>requete<span class="S10">)</span><span class="S0"> </span><span class="S5">throws</span><span class="S0"> </span>SQLException<span class="S0"> </span><span class="S10">{</span><br />
<span class="S0">&nbsp; &nbsp; </span><span class="S10">}</span><br />
<span class="S10">}</span><br />
<span class="S0"></span></span>
</body>
</html>
