---
layout: post
title: "IL fun fact: not is not !"
---
Picture yourself working on crafting a specific piece of CIL.

You need to write the compiled equivalent of:

<pre name="code" class="c-sharp:nocontrols:nogutter">
bool b = ...;
bool n = !b;
</pre>

It would be tempting to write:

<pre name="code" class="c-sharp:nocontrols:nogutter">
ldloc b
not
stloc n
</pre>

Except that it would not always work. <a href="http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.not.aspx">not</a> doesn't negate booleans, it computes the bitwise complement of the value on the stack. It's also not to be confused with the <a href="http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.neg.aspx">neg</a> opcode, which negates a value, as in a multiplication by -1.

The usual pattern to negate a boolean is:

<pre name="code" class="c-sharp:nocontrols:nogutter">
ldloc b
ldc.i4.0
ceq
stloc n
</pre>

But that's not really fun, is it?

Actual fun fact: there's a misused “not” in the ECMA 335 in the  example of the section 14.5 of the partition II.
